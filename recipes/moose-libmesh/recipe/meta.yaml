{% set name = "moose-libmesh" %}
{% set version = "3b8296b3b7c2b526d0be242fa6208750c0ede69b" %}
{% set sha256 = "2c77e16a854e02d26a579fc59d1f90ee35c790a6569ace3bbc59d063cbcdae3b" %}
{% set friendly_version = "2020.02.26" %}
{% set libmesh_build = 0 %}

{% set timpi_version = "255c92a47d73137a2d81ce72c54ae7db5b68e416" %}
{% set timpi_sha256 = "8e257d4b06b3a2e27b77bb82d26c2cb4f13c2123f8625e2e4d8289e35ca4b608" %}

{% set metaphysicl_version = "78f338a1508b4010a39a34d9fec9ee6247afaecf" %}
{% set metaphysicl_sha256 = "30ead616f1aad634ce270db2688f8c2b799a1f3b6a2f726a3bbf5abe1f923ac7" %}

package:
  name: {{ name }}
  version: {{ friendly_version }}

source:
  - url: https://github.com/libMesh/libmesh/archive/{{ version }}.tar.gz
    fn: libmesh-{{ version }}.tar.gz
    folder: src/github.com/libMesh/libmesh
    sha256: {{ sha256 }}

  - url: https://github.com/libMesh/TIMPI/archive/{{ timpi_version }}.tar.gz
    fn: timp-{{ timpi_version }}.tar.gz
    folder: timpi
    sha256: {{ timpi_sha256 }}

  - url: https://github.com/roystgnr/MetaPhysicL/archive/{{ metaphysicl_version }}.tar.gz
    fn: metaphysicl-{{ metaphysicl_version }}.tar.gz
    folder: metaphysicl
    sha256: {{ metaphysicl_sha256 }}

build:
  number: {{ libmesh_build }}
  skip: true                                            # [win]

requirements:
  build:
    - pkg-config
    - cctools                                           # [osx]
    - ld64                                              # [osx]
    - moose-libmesh-vtk {{ moose_libmesh_vtk }}
    - moose-petsc {{ moose_petsc }}

  run:
    - pkg-config
    - libnetcdf {{ netcdf }}                            # [linux]
    - moose-libmesh-vtk {{ moose_libmesh_vtk }}
    - moose-petsc {{ moose_petsc }}

test:
  commands:
    - test -f $PREFIX/libmesh/lib/libmesh_opt.dylib     # [osx]
    - test -f $PREFIX/libmesh/lib/libmesh_opt.so        # [linux]
    - test -f $PREFIX/libmesh/lib/libmetaphysicl.dylib  # [osx]
    - test -f $PREFIX/libmesh/lib/libmetaphysicl.so     # [linux]

about:
  home: http://libmesh.github.io/
  license: LGPL
  summary: 'The libMesh library provides a framework for the numerical simulation of partial differential equations using arbitrary unstructured discretizations on serial and parallel platforms'

extra:
  recipe-maintainers:
    - milljm
